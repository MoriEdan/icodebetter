<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>iCodeBetter</title>
	<link rel="shortcut icon" href="../ext3.4.1/custom/images/faviconicb.png">
    <noscript>Javascript must be enabled!</noscript>
<script>
function bodyKeydown(e){
  if(e.keyCode==70 && e.shiftKey && e.ctrlKey)globalSearch();
}
</script>
</head>
<body scroll="no" style="background:#1f2730;" onkeydown="bodyKeydown(event)">
    <div id="loading-mask" style="position:absolute;top:40%;left:48%;">
        <img src="data:image/svg+xml;base64,PCEtLSBCeSBTYW0gSGVyYmVydCAoQHNoZXJiKSwgZm9yIGV2ZXJ5b25lLiBNb3JlIEAgaHR0cDov&#13;&#10;L2dvby5nbC83QUp6YkwgLS0+CjwhLS0gVG9kbzogYWRkIGVhc2luZyAtLT4KPHN2ZyB3aWR0aD0i&#13;&#10;NTciIGhlaWdodD0iNTciIHZpZXdCb3g9IjAgMCA1NyA1NyIgeG1sbnM9Imh0dHA6Ly93d3cudzMu&#13;&#10;b3JnLzIwMDAvc3ZnIiBzdHJva2U9IiNmZmYiPgogICAgPGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxl&#13;&#10;PSJldmVub2RkIj4KICAgICAgICA8ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxIDEpIiBzdHJva2Ut&#13;&#10;d2lkdGg9IjIiPgogICAgICAgICAgICA8Y2lyY2xlIGN4PSI1IiBjeT0iNTAiIHI9IjUiPgogICAg&#13;&#10;ICAgICAgICAgICAgPGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iY3kiCiAgICAgICAgICAgICAgICAg&#13;&#10;ICAgIGJlZ2luPSIwcyIgZHVyPSIyLjJzIgogICAgICAgICAgICAgICAgICAgICB2YWx1ZXM9IjUw&#13;&#10;OzU7NTA7NTAiCiAgICAgICAgICAgICAgICAgICAgIGNhbGNNb2RlPSJsaW5lYXIiCiAgICAgICAg&#13;&#10;ICAgICAgICAgICAgIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIiAvPgogICAgICAgICAgICAgICAg&#13;&#10;PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iY3giCiAgICAgICAgICAgICAgICAgICAgIGJlZ2luPSIw&#13;&#10;cyIgZHVyPSIyLjJzIgogICAgICAgICAgICAgICAgICAgICB2YWx1ZXM9IjU7Mjc7NDk7NSIKICAg&#13;&#10;ICAgICAgICAgICAgICAgICAgY2FsY01vZGU9ImxpbmVhciIKICAgICAgICAgICAgICAgICAgICAg&#13;&#10;cmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiIC8+CiAgICAgICAgICAgIDwvY2lyY2xlPgogICAgICAg&#13;&#10;ICAgICA8Y2lyY2xlIGN4PSIyNyIgY3k9IjUiIHI9IjUiPgogICAgICAgICAgICAgICAgPGFuaW1h&#13;&#10;dGUgYXR0cmlidXRlTmFtZT0iY3kiCiAgICAgICAgICAgICAgICAgICAgIGJlZ2luPSIwcyIgZHVy&#13;&#10;PSIyLjJzIgogICAgICAgICAgICAgICAgICAgICBmcm9tPSI1IiB0bz0iNSIKICAgICAgICAgICAg&#13;&#10;ICAgICAgICAgdmFsdWVzPSI1OzUwOzUwOzUiCiAgICAgICAgICAgICAgICAgICAgIGNhbGNNb2Rl&#13;&#10;PSJsaW5lYXIiCiAgICAgICAgICAgICAgICAgICAgIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIiAv&#13;&#10;PgogICAgICAgICAgICAgICAgPGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iY3giCiAgICAgICAgICAg&#13;&#10;ICAgICAgICAgIGJlZ2luPSIwcyIgZHVyPSIyLjJzIgogICAgICAgICAgICAgICAgICAgICBmcm9t&#13;&#10;PSIyNyIgdG89IjI3IgogICAgICAgICAgICAgICAgICAgICB2YWx1ZXM9IjI3OzQ5OzU7MjciCiAg&#13;&#10;ICAgICAgICAgICAgICAgICAgIGNhbGNNb2RlPSJsaW5lYXIiCiAgICAgICAgICAgICAgICAgICAg&#13;&#10;IHJlcGVhdENvdW50PSJpbmRlZmluaXRlIiAvPgogICAgICAgICAgICA8L2NpcmNsZT4KICAgICAg&#13;&#10;ICAgICAgPGNpcmNsZSBjeD0iNDkiIGN5PSI1MCIgcj0iNSI+CiAgICAgICAgICAgICAgICA8YW5p&#13;&#10;bWF0ZSBhdHRyaWJ1dGVOYW1lPSJjeSIKICAgICAgICAgICAgICAgICAgICAgYmVnaW49IjBzIiBk&#13;&#10;dXI9IjIuMnMiCiAgICAgICAgICAgICAgICAgICAgIHZhbHVlcz0iNTA7NTA7NTs1MCIKICAgICAg&#13;&#10;ICAgICAgICAgICAgICAgY2FsY01vZGU9ImxpbmVhciIKICAgICAgICAgICAgICAgICAgICAgcmVw&#13;&#10;ZWF0Q291bnQ9ImluZGVmaW5pdGUiIC8+CiAgICAgICAgICAgICAgICA8YW5pbWF0ZSBhdHRyaWJ1&#13;&#10;dGVOYW1lPSJjeCIKICAgICAgICAgICAgICAgICAgICAgZnJvbT0iNDkiIHRvPSI0OSIKICAgICAg&#13;&#10;ICAgICAgICAgICAgICAgYmVnaW49IjBzIiBkdXI9IjIuMnMiCiAgICAgICAgICAgICAgICAgICAg&#13;&#10;IHZhbHVlcz0iNDk7NTsyNzs0OSIKICAgICAgICAgICAgICAgICAgICAgY2FsY01vZGU9ImxpbmVh&#13;&#10;ciIKICAgICAgICAgICAgICAgICAgICAgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiIC8+CiAgICAg&#13;&#10;ICAgICAgIDwvY2lyY2xlPgogICAgICAgIDwvZz4KICAgIDwvZz4KPC9zdmc+">
    </div>

    <link rel="stylesheet" type="text/css" href="../ext3.4.1/full.css" />
    <link rel="stylesheet" type="text/css" href="../ext3.4.1/custom/iwb.css" />

    <script type="text/javascript" src="../ext3.4.1/full.js"></script>

    <script type="text/javascript" src="../ext3.4.1/lang/ext-lang-${scd.locale}.js"></script>

    <script type="text/javascript" src="../monaco/min/vs/loader.js"></script>
    <script type="text/javascript" src="../monaco/icb-monaco.js"></script>

    <script>${localemsg}</script>




    <!-- AMCHARTS SCRIPTS -->
          <script src="../amcharts/amcharts.js"></script>
    <script src="../amcharts/serial.js"></script>
    <script src="../amcharts/pie.js"></script>
    <script src="../amcharts/plugins/export/export.min.js"></script>
    <link rel="stylesheet" href="../amcharts/plugins/export/export.css" type="text/css" media="all" />
    <script src="../amcharts/themes/black.js"></script>
    <!-- AMCHARTS SCRIPTS -->

    <!-- iCODEBETTER SCRIPTS -->
    <script type="text/javascript" src="../ext3.4.1/custom/iwb.js"></script>
    <script type="text/javascript" src="../ext3.4.1/custom/override.js"></script>
    <!-- iCODEBETTER SCRIPTS -->

    <script type="text/javascript" src="../enjoyhint/jquery-1.11.1.min.js"></script>

	<!-- NOTY -->
    <script type="text/javascript" src="../noty/noty.min.js"></script>
    <!-- NOTY -->


    <script type="text/javascript" src="../scripts/jkanban/jkanban.min.js"></script>



    ${gridColorCss}

<div id="header2" style="width:100%;color:white;height:36px;left: 0px; padding-left:3px;padding-top:1px;top: 0px;    background: #3f4757;">
    <div id="bmpHeader" style="width:245px;height:36px;background-image: url(http://icodebetter.com/wp-content/uploads/2018/07/icodebetter-logo.png);position:absolute;left:0;top:0;background-repeat: no-repeat;background-size: 193px 36px;background-position-x: 7px;"></div>
    <div class="api-title" style="color:white;width:100%;font:normal 11px verdana,arial,tahoma;margin-top:0px;">
        <table border="0" cellpadding="1" cellspacing="1" style="width:100%" valign="center" >
            <tr>
                <td width="215px"></td>
                <td><div class="api-title" id="bmpHeaderCenter" style="color:white;left:0px;top:0px;font:normal 11px verdana,arial,tahoma;padding-top: 5px;"> &nbsp; <a href="#" id="idUIBuilder" onclick="return mainPanel.loadTab({attributes:{href:'showPage?_tid=8'}})" class="xaction">UI Wizard</a> &nbsp; <a id="idPreviewLink" target="${scd.projectId}" href="../preview/${scd.projectId}/main.htm"  class="xbutton"><img src="../ext3.4.1/custom/images/bolt-16.png" border="0" style="vertical-align: middle;padding-right: 5px;margin-bottom: 2px;">App Preview</a> &nbsp; <a id="idVCSLink" onclick="mnuVCS.showAt([event.clientX, event.clientY + 10]);return false" href="#" class="xbutton"><img src="../ext3.4.1/custom/images/vcs1.png" border="0" style="vertical-align: middle;padding-right: 5px;margin-bottom: 2px;">Version Control</a> &nbsp; <a id="idDocsLink" target="icb-docs" href="http://docs.icodebetter.com" class="xbutton">Documentation</a> </div></td>
<!--                <td id="idSlackLink2" width="1px"><a id="idSlackLink" onclick="alert('todo');return false"  href=#><svg xmlns="http://www.w3.org/2000/svg" viewBox="50 70 160 140" width="36" aria-label="Slack" class="c-slacklogo--color svg-replaced" shape-rendering="geometricPrecision"><path fill="#ECB32D" d="M141.8 87.1c-1.9-5.7-8-8.8-13.7-7-5.7 1.9-8.8 8-7 13.7l28.1 86.4c1.9 5.3 7.7 8.3 13.2 6.7 5.8-1.7 9.3-7.8 7.4-13.4 0-.2-28-86.4-28-86.4z"></path><path fill="#63C1A0" d="M98.3 101.2c-1.9-5.7-8-8.8-13.7-7-5.7 1.9-8.8 8-7 13.7l28.1 86.4c1.9 5.3 7.7 8.3 13.2 6.7 5.8-1.7 9.3-7.8 7.4-13.4 0-.2-28-86.4-28-86.4z"></path><path fill="#E01A59" d="M177.2 158.6c5.7-1.9 8.8-8 7-13.7-1.9-5.7-8-8.8-13.7-7L84 166.1c-5.3 1.9-8.3 7.7-6.7 13.2 1.7 5.8 7.8 9.3 13.4 7.4.2 0 86.5-28.1 86.5-28.1z"></path><path fill="#331433" d="M102 183.1c5.6-1.8 12.9-4.2 20.7-6.7-1.8-5.6-4.2-12.9-6.7-20.7l-20.7 6.7 6.7 20.7z"></path><path fill="#D62027" d="M145.6 168.9c7.8-2.5 15.1-4.9 20.7-6.7-1.8-5.6-4.2-12.9-6.7-20.7l-20.7 6.7 6.7 20.7z"></path><path fill="#89D3DF" d="M163 115.1c5.7-1.9 8.8-8 7-13.7-1.9-5.7-8-8.8-13.7-7l-86.4 28.1c-5.3 1.9-8.3 7.7-6.7 13.2 1.7 5.8 7.8 9.3 13.4 7.4.2 0 86.4-28 86.4-28z"></path><path fill="#258B74" d="M87.9 139.5c5.6-1.8 12.9-4.2 20.7-6.7-2.5-7.8-4.9-15.1-6.7-20.7l-20.7 6.7 6.7 20.7z"></path></svg></a></td> -->
                <td id="idGlobalSearch" width="1px"><a title="Global Search (Ctrl+Shift+F)" href=# onclick="return globalSearch();"><img border=0 src="../ext3.4.1/custom/images/search-24.png"/></a></td>
                <td id="idKanban" width="1px" style="padding:0 10px;"><a title="Tasks (Ctrl+Shift+?)" href=# onclick="return kanbanTask();"><img border=0 src="../ext3.4.1/custom/images/kanban-26.png"/></a></td>
                <td id="newMsgTd" style="width:40px;" valign="middle" ><a title="Project Team" href=# onclick="return toggleChatW();"><img border=0 src="../ext3.4.1/custom/images/team-24.png"/><span id="idNewMsgCount" style="display:none;color:#fff;padding: 1px 3px;background-color: #E30;background-image: -webkit-linear-gradient(#fa3c45, #E30);-webkit-border-radius: 2px;-webkit-box-shadow: 0 1px 1px rgba(0, 0, 0, .7);position: absolute;margin-left:-7px;font-size:10px;font-weight:bold;">+9</span></a></td>
				<td width="1px" id="userImageTd"></td>
                <td style="padding-right:10px;" width="1px" id="userNameTd"></td>
                <td width="1px" id="switchRole"></td>
<!--                <td width="30px" id='logoutBtn'><a href="login.htm" title="${exit}"><img border=0 src="../ext3.4.1/custom/images/logout-24.png"/></td>
-->
            </tr>
        </table>
    </div>
</div>

<label id="footer2" style="width:100%;height:22px;">
</label>

<style>
.CodeMirror {
    height: inherit;
    min-height:50px;
}
.cm-s-blackboard.CodeMirror {
    background: #1e2532 !important;
}
.x-portlet .x-panel-body {
    background: inherit;
}

.x-grid3-row {
    border-bottom: 1px solid #1b232b;
    border-right: none;
}
.x-fieldset {
    border: none;
    border-top: 1px solid #3f4757;
}

.p2x{
  padding:2px !important;
}
.xbutton{
    color: white !important;
    padding: 4px 10px;
    background: #3f4757;
    font-size: 13px;
    border: #6a7b9c 1px solid;
    transition: background .2s;
}
.xbutton:hover{
  background:#61b9e3;
  text-decoration:none !important;
}
.x-toolbar {
    border-top: none !important;
}
.xaction{
    color: white !important;
    padding: 4px 10px;
    background: #8BC34A;
    font-size: 13px;
    border: #9BD35A 1px solid;
    transition: background .2s;
}
.xaction:hover{
  background:#79c520;
  text-decoration:none !important;
}

.x-tab-strip-active span.x-tab-strip-text {
    font-weight: normal;
}

.x-toolbar .xtb-sep {
    background-image: none;
    background: #1f2933;
    width: 1px;
}
.veliSelGray{
    background-color: #737b8c;
}
td.ux-grid-hd-group-cell {
    background: none;
}
.ext-el-mask {
    background-color: #1f2730;
}
.ext-el-mask-msg {
    background: transparent;border: none;
}
.ext-el-mask-msg div{
    border-radius:50px;
}
.red-reload tbody{
   background: #F44336;
}

.xchatw .x-window-tl, .xchatw .x-window-tr, .xchatw .x-window-tc, #idOnlineUsersPanel .x-panel-header {
    background:#13a2c9; /*#3f89dc; #de4c4f; */
}
.xchatw textarea{
  border-color:#de4c4f;
}

.x-grid3-cell-inner, .x-grid3-hd-inner {
    padding: 5px 3px 4px 5px;
}

.ext-strict .ext-webkit .x-small-editor .x-form-text {
    height: 18px !important;
}

#idOnlineUsersPanel .x-list-body-inner {
    background-color: #3f4757;
}

#idOnlineUsersPanel .x-list-over {
    background-color:#363a52;
}


.x-panel-header {
    font-weight: normal;
}

.x-editor .x-form-check-wrap {
background-color: inherit;
padding-top: 9px;padding-left: 5px;
}
.x-editor .x-form-check-wrap label{
  display:none;
}

.noty_layout{
  font-family:tahoma, arial, helvetica, sans-serif;
}
#noty_layout__bottomCenter {
    width: 800px !important;
}
#noty_layout__topCenter {
    width: 420px !important;
}
#noty_layout__topCenter .noty_body{
    padding: .5em;
}

.x-window.x-panel-collapsed .x-window-tl, .x-window.x-panel-collapsed .x-window-tc, .x-window.x-panel-collapsed .x-window-tr{
	background: #8bc34a !important;
}

.kanban-container,.kanban-container *{box-sizing:border-box}.kanban-board:after,.kanban-container:after{clear:both;content:""}.kanban-board,.kanban-item{transition:all .3s cubic-bezier(.23,1,.32,1)}.kanban-container{position:relative;width:auto}.kanban-container:after{display:block}.kanban-board{position:relative;float:left;background:#E2E4E6}.kanban-board.disabled-board{opacity:.3}.kanban-board.is-moving.gu-mirror{transform:rotate(3deg)}.kanban-board.is-moving.gu-mirror .kanban-drag{overflow:hidden;padding-right:50px}.kanban-board header{font-size:16px;padding:13px 15px;height: 45px;}.kanban-board header .kanban-title-board{margin:0;padding:0;display:inline}.kanban-board header .kanban-title-button{float:right}.kanban-board .kanban-drag{min-height:200px;padding:20px 15px;}.kanban-board:after{display:block}.kanban-item{background:#4e596e;padding:15px;margin-bottom:15px}.kanban-item:last-child{margin:0}.kanban-item.is-moving.gu-mirror{transform:rotate(3deg);height:auto!important}.gu-mirror{position:fixed!important;margin:0!important;z-index:9999!important}.gu-hide{display:none!important}.gu-unselectable{-webkit-user-select:none!important;-moz-user-select:none!important;-ms-user-select:none!important;user-select:none!important}.gu-transit{opacity:.2!important;transform:rotate(0)!important}

.kanban-board {
    background: #2f3849 !important;
}
.kanban-title-button{
    background: none;
    border: none;
    color: white;
    font-size: 25px;
    margin-top: -4px;
    cursor: pointer;
    padding: 0 4px;
}

.kanban-item{
  font-family:tahoma;
}
.success{background: #8BC34A; color:#fff}
.info{background:#15add7; color:#fff}
.warning{background: #f38a0f; color:#fff}
.error{background: #FB7D44; color:#fff}
</style>

<script>

Ext.Updater.defaults.timeout=60*60;
Ext.Ajax.timeout=60*60000;
var isDown = false;

iwb.guideUser=true;

iwb.mobileChannel=function(ax, fnc, sfnc, cfnc){
  if(!iwb.mobileMap[ax])iwb.mobileMap[ax]={};
  iwb.mobileMap[ax].renderForm=fnc;//renderForm
  iwb.mobileMap[ax].selectCell=sfnc;//selectCell
  iwb.mobileMap[ax].changeTheme=cfnc;//changeTheme
};


function toggleChatW() {
	var w = Ext.getCmp('idOnlineUsersPanel');
	if (!w) return false;
	if (w.collapsed) w.expand();
	else w.collapse();
	return false;
}

function kanbanTask(){
  mainPanel.loadTab({attributes:{id:'idMyTasks',href:'showPage?_tid=2515'}})
}

function updateChatMsgCount(cnt) {
	var c = Ext.get('idNewMsgCount');
	if (!c) return;
	if (!c._lastCnt) c._lastCnt = 0;
	else if (cnt < 0) {
		cnt = c._lastCnt + cnt;
		if (cnt < 0) cnt = 0;
	}
	if (cnt != c._lastCnt) {
		var d = c.dom;
		d.innerText = cnt > 9 ? '9+' : cnt;
		d.style.display = cnt ? '' : 'none';
		c._lastCnt = cnt;
	}
}




function globalSearchKeydown(e){
  switch(e.keyCode){
      case	27://esc
      globalSearch();
      break;
    case 13://enter
      var s= document.getElementById('idGSearchInput').value;
      if(s && s.length>1){
      promisRequest({url:'ajaxQueryData?_qid=4471',params:{xsearch_tip:document.getElementById('idGFSearch').elements['xsearch_tip'].value, xdsc:s}, successCallback:function(j){
          if(j.data.length){
            var d=j.data, sx='';
            for(var qi=0;qi<d.length;qi++){
              var o=d[qi];
              var x=o.xmatch;
              var xi=x.indexOf(s);
              if(xi>=0){x=x.substr(0,xi)+'<span style="color: black;background:#FFC107">'+s+'</span>'+x.substr(xi+s.length)}
              sx+='<b>'+o.table_name+'</b>: <a  style="color:#2196f3 !important;" onclick="return fnTblRecEdit('+o.table_id+','+o.table_pk+')" href=>'+o.object_name+'</a><br/>'+x+' <br/> <br/>';
            }
            Ext.infoMsg.log('SEARCH RESULTS<br/>', sx);
      			globalSearch(false);
          } else {
            document.getElementById('idGSearchInput').select();
            Ext.infoMsg.msg('warning','no results found',2);
          }
        }});
      } else Ext.infoMsg.msg('warning','write at least 2 character',2);
      break;
  }
//  console.log("globalSearchKeypress",e);
}
function globalSearch(f){
  var gs=document.getElementById('idGSearch');
  if(gs){
    var d=gs.style.display;
    if(d || f===true){if(!d)return;
     gs.style.display=null;
     document.getElementById('idGSearchInput').focus();
     document.getElementById('idGSearchInput').select();
    } else if(!d || f===false){
      if(d)return;
      gs.style.display='none';
    }
  }
}

function addProjectMember(){
  var mem=prompt('Enter Member nickname or email adress');
  if(mem){
    promisRequest({url:'ajaxExecDbFunc?_did=1245',params:{member:mem},successCallback:reloadOnlineUsers});
  }
    return false
}
var devMenuPanel=false;
function reloadDevMenu(){
  devMenuPanel.root.removeAll();
  devMenuPanel.loader.baseParams={xuser_tip:cmbUserType.getValue()};
  devMenuPanel.loader.load(devMenuPanel.root);
  var pl = document.getElementById('idPreviewLink');
  pl.target=_scd.projectId;
  pl.href='../preview/'+_scd.projectId+'/main.htm?xuser_tip='+cmbUserType.getValue()+'&.r='+Math.random();

}
function reloadCache(rcfg){
  promisRequest({url:'reloadCache?.r='+new Date().getTime(), requestWaitMsg:true,successCallback: function(){Ext.infoMsg.msg('success','iWB Cache Reloaded');if(rcfg && rcfg.callback)rcfg.callback();}});
return false;
}

${promis}

if (typeof _webPageId == 'undefined') {
	_webPageId = "wpi_" + Math.random() + new Date().getTime();
}


iwb.getCellVal=function(field,ax,bx,cx){
return cx ? cx.get(field):null;
}

var _feedSearchStore = false;

function loginUserRole(userRoleId, userCustomizationId) {
	Ext.Ajax.request({
		url: "ajaxSelectUserRole?userRoleId=" + userRoleId + "&userCustomizationId=" + (userCustomizationId || _scd.userCustomizationId),
		success: function() {
			Ext.Msg.wait('${signing_into_system}', '${please_wait}...');
			document.location = 'main.htm?.r=' + new Date().getTime();
		}
	});
}

var mnuVCS=new Ext.menu.Menu({
				enableScrolling: false,
				items: [{iconCls:'icon-vcs',text:'Synchronize Metadata',handler:function(aq){
			mainPanel.loadTab({attributes:{id:'idVCSObjectList', modalWindow:false,href:'showPage?_tid=238&_gid1=725'}});
		}},{iconCls:'icon-db',text:'Synchronize DB Scripts',handler:function(aq){
			mainPanel.loadTab({attributes:{modalWindow:true, href:'showPage?_tid=543&_gid1=2130&_gid2=2057&_gid3=2129'}});
		}},'-',{iconCls:'icon-locale',text:'Synchronize LocaleMsgs',handler:function(aq){
          	if(confirm('LocaleMsg seknronize etmek istediğinizden emin misiniz?'))promisRequest({timeout:10000000,url:'ajaxVCSClientSynchLocaleMsg?.r='+Math.random(), requestWaitMsg:true});
		}},'-',{iconCls:'icon-error',text:'Error Fix',handler:function(aq){
			mainPanel.loadTab({attributes:{modalWindow:true, _title_:'All',href:'showPage?_tid=238&_gid1=729'}});
		}},{iconCls:'icon-return',text:'Restore from VCS Server',handler:function(aq){
			mainPanel.loadTab({attributes:{modalWindow:true, _title_:'All',href:'showPage?_tid=238&_gid1=3556'}});
		}},{text:'DB Scripts History',handler:function(aq){
			mainPanel.loadTab({attributes:{modalWindow:true, _title_:'All',href:'showPage?_tid=238&_gid1=3557'}});
		}}]});


var lurw = false,
	multiRoleMenu = false;
var notificationReloadTask = null;
var timerChat;

function selectUserRole(e) {
	//    grd_select_role1.ds.un('loadexception');
	if (window.event) e = window.event;
	if (!e.ctrlKey) {
		if (!multiRoleMenu) {
			var roleMenuItems = [],
				qd = qry_select_user_role1.data
			for (var qi = 0; qi < qd.length; qi++) {
				var it = {
					_id: qd[qi].user_role_id,
					text: qd[qi].role_id_qw_ + (qd[qi].unit_id_qw_ ? ' · ' + qd[qi].unit_id_qw_ : ""),
					handler: function(ax) {
						loginUserRole(ax._id)
					}
				}
				if (1 * qd[qi].user_role_id == _scd.userRoleId) it.text = '<b>' + it.text + '</b>';
				roleMenuItems.push(it)
			}

			multiRoleMenu = new Ext.menu.Menu({
				enableScrolling: false,
				items: roleMenuItems
			});
		}
		multiRoleMenu.showAt([e.clientX, e.clientY + 10])
		return;
	}

	var roleCount = _scd.roleCount,
		defaultUserCustomizationId = _scd.userCustomizationId;
	var gg = new Ext.grid.GridPanel(Ext.apply(grd_select_role1, {
		region: 'center',
		stripeRows: true,
		autoScroll: true,
		listeners: {
			rowdblclick: function() {
				loginUserRole(gg.getSelectionModel().getSelected().id, cb.getValue())
			}
		}
	}));
	var cb = new Ext.form.ComboBox({
		width: 200,
		x: 170,
		y: 15,
		valueField: 'id',
		displayField: 'dsc',
		store: new Ext.data.JsonStore({
			url: 'ajaxQueryData?_=_',
			baseParams: {
				_qid: '824'
			},
			root: 'data',
			autoLoad: true,
			totalProperty: 'browseInfo.totalCount',
			id: 'id',
			fields: [{
				name: 'dsc'
			}, {
				name: 'id',
				type: 'int'
			}],
			listeners: {
				loadexception: function() {
					if (lurw && lurw.isVisible()) {
						lurw.destroy();
						showLoginDialog();
					}
				},
				load: function() {
					cb.setValue(defaultUserCustomizationId);
				}
			}
		}),
		editable: false,
		typeAhead: false,
		mode: 'local',
		triggerAction: 'all'
	});

	var pp = new Ext.Panel({
		region: 'north',
		layout: 'absolute',
		height: 55,
		items: [new Ext.form.Label({
			text: 'Görünüm:',
			style: 'font-size: 12px',
			x: 100,
			y: 17
		}), cb]
	});
	lurw = new Ext.Window({
		modal: true,
		title: '${please_select_the_role_you_want_to_use}',
		width: 500,
		height: 300,
		border: false,
		layout: 'border',
		items: [pp, gg],
		buttons: [{
			text: '${select}',
			handler: function() {
				var sel = gg.getSelectionModel().getSelected()
				if (!sel) {
					alert('${first_you_have_to_select_sth}!')
					return
				}
				loginUserRole(sel.id, cb.getValue());
			}
		}]
	});
	gg.store.reload();
	lurw.show();
	return false;
}



MenuPanel = function(cfg) {
	MenuPanel.superclass.constructor.call(this, {
		id: cfg && cfg.id ? cfg.id : 'api-tree',
		region: cfg && cfg.region ? cfg.region : 'center',
		border: false,useArrows:true,
		header: false,
		split: cfg && cfg.split ? cfg.split : false,
		rootVisible: false,
		lines: false,
		autoScroll: true,
		animate: true,
		dataUrl : cfg && cfg.dataUrl ? cfg.dataUrl : undefined,
		loader: cfg && cfg.dataUrl ? undefined: new Ext.tree.TreeLoader({
			preloadChildren: true,
			clearOnLoad: false
		}),
		root: cfg && cfg.menu ? new Ext.tree.AsyncTreeNode({
			text: 'iCodeBetter',
			id: 'root',
			expanded: true,
			children: cfg.menu
		}) : {
			nodeType: 'async',
			draggable: false
		},
		tbar: cfg && cfg.tbar ? cfg.tbar: false,
		bbar:cfg && cfg.bbar ? cfg.bbar: false,
		title: cfg && cfg.title ? cfg.title: false,
		collapseFirst: false

	});

	this.getSelectionModel().on('beforeselect', function(sm, node) {
		return node.isLeaf();
	});
};

Ext.extend(MenuPanel, Ext.tree.TreePanel, {
	initComponent: function() {
		this.hiddenPkgs = [];
		MenuPanel.superclass.initComponent.call(this);
	},
  	filterTree: function(t, e) {
		var text = t.getValue();
		if (!text) {
			this.filter.clear();
			this.collapseAll();
			return;
		}
		this.expandAll();

		//        var re = new RegExp(Ext.escapeRe(text), 'i');
		var tqt = text.toLowerCase();
		var fxx = function(n) {
			if (n.attributes.leaf) {
				if (n.text.toLowerCase().indexOf(tqt) > -1) {
					return true;
				} else if (n.parentNode && n.parentNode.text && n.parentNode.text.toLowerCase().indexOf(tqt) > -1) {
					return true;
				}
			} else {
				if (n.text.toLowerCase().indexOf(tqt) > -1) {
					return true;
				} else if (n.childNodes.length > 0)
					for (var qi = 0; qi < n.childNodes.length; qi++) {
						if (fxx(n.childNodes[qi])) return true;
					}
			}
			return false;
		}
		this.filter.filterBy(fxx);
	}

});

var scrollerMenu = new Ext.ux.TabScrollerMenu({
	maxText: 15,
	pageSize: 5
});

var _history = [],
	tabIdMap = {};

function getTabIdFromX(x) {
	var q = tabIdMap[x];
	if (!q) return "--*--";
	else return q;
}

function add2history(a, p) { //attributes, panel
	if (!a || !a.id || !p) return;
	for (var qi = 0; qi < _history.length; qi++)
		if (_history[qi].id == a.id) { //daha once varmis, sil onu
			_history.splice(qi, 1);
			break;
		}
	_history.push({
		id: a.id,
		href: a.href,
		title: p.title
	});
}
var mainPanel = new Ext.TabPanel({
	id: 'doc-body',
	region: 'center',
	margins: '0 0 5 0',
	resizeTabs: true,
//	minTabWidth: 135,
	tabWidth: 135,
	enableTabScroll: true,
	modalWindows: [],
	chatWindows: [],
	modalWindowCount: 0,
	chatWindowCount: 0,
	plugins: [new Ext.ux.TabCloseMenu(), scrollerMenu, new Ext.ux.panel.DraggableTabs()],
	listeners: {
		tabchange: function(t, p, r) {
			if (!p._dontCallTabchange) promisRequest({
				url: 'ajaxLiveSync?.a=14&.t=' + p.id,
				requestWaitMsg: false,
				successResponse: function() {}
			});
			else p._dontCallTabchange = false;// TODO neden?
		},close:function(aq,bq){alert(aq)},
		reorder: {
			fn: function(tabPanel, movedTab) {
				// do something here
			}
		}
	},doClose : function(excludeActive){
        var items = [];
        this.items.each(function(item){
            if(item.closable){
                if(!excludeActive || item != this.active){
                    items.push(item);
                }
            }
        }, this);
        Ext.each(items, function(item){
            this.remove(item);
        }, this);
    },
	showChatWindow: function(w) {
		w.show();
		var maxC = mainPanel.chatWindowCount;
		if (maxC > 4) maxC = 4;
		w.alignTo(mainPanel.getEl(), 'br-br', [-maxC * (10 + w.width) - 10, -15])
		w._chatId = mainPanel.chatWindowCount;
		mainPanel.chatWindows[mainPanel.chatWindowCount++] = w;
		w.getEl().applyStyles('opacity:0.95');
		w.getEl().slideIn('b', {
			duration: 0.2
		});
		w.on('hide', mainPanel.destroyChatWindow);
	},
	showModalWindow: function(w) {
		w.show(null, function() {
        	mainPanel.fireEvent('modalWindowShown', w);
        });

		if (w._windowCfg && w._windowCfg.slideIn) w.slideIn(w._windowCfg.slideIn, {
			duration: 0.2
		});

		mainPanel.modalWindows[mainPanel.modalWindowCount++] = w;
		w.on('hide', mainPanel.destroyModalWindow);
	},
	destroyChatWindow: function(w) {
		if (mainPanel.chatWindowCount > 0) {
			var idx = w._chatId;
			if (mainPanel.chatWindowCount > 1) {
				var newAr = [];
				for (var qi = 0, qj = 0; qi < mainPanel.chatWindowCount; qi++)
					if (qi != idx) {
						newAr[qj] = mainPanel.chatWindows[qi];
						mainPanel.chatWindows[qi]._chatId = qj;
						qj++;
					}
				mainPanel.chatWindows = newAr;
			}
			w.destroy();
			mainPanel.chatWindowCount--;
			var elx = mainPanel.getEl();
			for (qi = 0; qi < mainPanel.chatWindowCount; qi++) mainPanel.chatWindows[qi].alignTo(elx, 'br-br', [-(qi > 4 ? 4 : qi) * (10 + mainPanel.chatWindows[qi].width) - 10, -15])
			return true;
		} else
			return false;
	},
	closeModalWindow: function() {
		if (mainPanel.modalWindowCount > 0) {
			mainPanel.modalWindows[mainPanel.modalWindowCount - 1].hide();
			return true;
		} else
			return false;
	},
	destroyModalWindow: function() {
		if (mainPanel.modalWindowCount > 0) {
			mainPanel.modalWindowCount--;
			mainPanel.modalWindows[mainPanel.modalWindowCount].destroy();
			delete mainPanel.modalWindows[mainPanel.modalWindowCount];
			return true;
		} else
			return false;
	},
	loadTab: function(n, e) {
		if (n.attributes.href != null) {
			var newId = null;
			if ((!e || !e.ctrlKey) && (n.attributes.id) && Ext.get(newId = getTabIdFromX("promis_" + n.attributes.id))) {
				if(mainPanel.getActiveTab().id==newId){
					mainPanel.fireEvent('tabchange', mainPanel, mainPanel.getActiveTab());
				} else mainPanel.setActiveTab(newId);
				if (n.successCallback) n.successCallback({active:true});
				return false;
			} else {

				var url = n.attributes.href // + '&.r=' + Math.random();
				var xparams = n.attributes.params || {};
				if (typeof _webPageId != 'undefined') {
					if (!xparams['.w']) xparams['.w'] = _webPageId;
				}

				if (true || 1 * _app.request_wait_msg) Ext.Msg.wait('${please_wait}')

				Ext.Ajax.request({
					url: url,
					params: xparams,
					success: function(o) {

						if (true || 1 * _app.request_wait_msg) Ext.Msg.hide()
						var f = null;
						try {
							eval("f=function(callAttributes){" + o.responseText + '};');
						} catch (e) { //gelen string compile edilemiyor. ciddi hata
							if(1*_app.debug){
								if(confirm("ERROR eval(f=...)!!! Throw?"))throw e;
								else return false;
							} else {
								alert("System Error! Code: 10021");return false;
							}
						}
						try{//compile edildi, calistirma esnasinda problemler cikabilir
							var mwf = (url.indexOf('showPage') > -1 || !(1 * _app.form_modal_window)) && !(n.attributes.modalWindow || (n.attributes.extraCode && n.attributes.extraCode.modalWindow))
							var _tid = false;
							if (xparams && xparams["_tid"]) _tid = xparams["_tid"];
							else if (url && url.indexOf('_tid=') > -1) {
								var str = url.substr(url.indexOf('_tid=') + 5);
								if (url.indexOf('&') > -1) _tid = str.substr(0, url.indexOf('&'));
								else _tid = str;
							}
							var p = f(Ext.apply({
								modalWindowFlag: !mwf
							}, n.attributes));
//                          console.log(p)
							if (!p) return;
							if (typeof n.attributes.iconCls != 'undefined' && n.attributes.iconCls == '' && n.attributes.icon != '' && typeof n.attributes.icon != 'undefined') {
								Ext.util.CSS.createStyleSheet('.menu-icon-' + n.attributes.id + ' { background-image: url(' + n.attributes.icon + ') !important; }');
								p.iconCls = 'menu-icon-' + n.attributes.id;
							}
							if (mwf) {
								if ((!e || !e.ctrlKey) && n.attributes.id) {
									if (!p.id) p.id = 'promis_' + n.attributes.id;
									tabIdMap['promis_' + n.attributes.id] = p.id;
								}
								// p.bodyStyle= p.bodyStyle ? p.bodyStyle+";"+"background-image:url(../images/mus_tr/bg_square.png)" : "background-image:url(../images/mus_tr/bg_square.png)";
								if (_tid) p._tid = _tid;
								if (p._l) { //form
									promisRequest({
										url: 'ajaxLiveSync?.a=10&.t=' + p.id + (p._l.pk ? '&.pk=' + p._l.pk : ''),
										requestWaitMsg: false,
										successResponse: function() {}
									});
									p._dontCallTabchange = true;
									p.on('destroy', function(tab) {
										promisRequest({ url: 'ajaxLiveSync?.a=2&.t=' + tab.id + (tab._l.pk ? '&.pk=' + tab._l.pk : ''), requestWaitMsg: false, successResponse: function() {} });
									});
								} else if (p._lg) { //grid
									p.on('destroy', function(tab) {
										promisRequest({ url: 'ajaxLiveSync?.a=12&.t=' + tab.id, requestWaitMsg: false, successResponse: function() {} });
									});
								}
								if(p.title===false){p.autoWidth=true;}
								mainPanel.add(p);
								mainPanel.setActiveTab(p);
								add2history(n.attributes, p);
								if (p.refreshGrids) {
									var arr = p.refreshGrids;
									for (var i = 0; i < arr.length; i++) {
										if (arr[i].store) arr[i].store.reload();
									}
								}

							} else {
								var modalWindow = {
									modal: true,
									autoScroll: true,
									title: p._title_ || 'Form',
									width: p._width_ || 800,
									height: p._height_ || 600,
									items: p,
									listeners: {
										"resize": function(aq, bq, cq) {
											if (typeof p.onresize == 'function') {
												p.onresize(aq, bq, cq);
											}
										}
									}
								}
								if (n.attributes.slideIn) p._windowCfg = Ext.apply(p._windowCfg || {}, {
									slideIn: n.attributes.slideIn
								});
								if (p._windowCfg) modalWindow = Ext.apply(modalWindow, p._windowCfg)
								if ((!e || !e.ctrlKey) && n.attributes.id) p.id = 'promis_' + n.attributes.id;
								if (p._windowCfg && p._windowCfg.modal === false) mainPanel.showChatWindow(new Ext.Window(modalWindow));
								else mainPanel.showModalWindow(new Ext.Window(modalWindow));

								if (p.refreshGrids) {
									var arr = p.refreshGrids;
									for (var i = 0; i < arr.length; i++) {
										if (arr[i].store) arr[i].store.reload();
									}
								}
							}
							if (p.successCallback) p.successCallback(p);
							if (n.successCallback) n.successCallback(p);
						} catch(e){
							if(1*_app.debug){
								console.log(p);
								if(confirm("ERROR loadTab(p)!!! Throw?"))throw e;
								else return false;
							} else {
								alert("System Error! Code: 10022");return false;
							}
						}
					},
					failure: function(o) {
						if (true || 1 * _app.request_wait_msg) Ext.Msg.hide()
						promisLoadException(o)
					}
				});
			}
		}
	}
});

//-- Fires when a modal window shown. Mainly added to be used in tutorials.
mainPanel.addEvents('modalWindowShown');

if (_app.chat_flag && 1 * _app.chat_flag) mainPanel.on('resize', function() {
	var elx = mainPanel.getEl();
	for (qi = 0; qi < mainPanel.chatWindowCount; qi++) mainPanel.chatWindows[qi].alignTo(elx, 'br-br', [-(qi > 4 ? 4 : qi) * (10 + mainPanel.chatWindows[qi].width) - 10, -15])
})

var menuPanel = null,
	mainViewport = null,
	onlineUsersGridPanel = null,
	chatStatusMenu = null,
	onlineUsersTask = null;


function reloadOnlineUsers(force) {
	if (onlineUsersGridPanel && _scd.chatStatusTip > 0) {
		if (onlineUsersTask) onlineUsersTask.cancel();
		var pusersOnline = Ext.get("idOnlineUsersPanel");
		if (force || (pusersOnline && pusersOnline.isVisible())) {
			onlineUsersGridPanel.store.reload();
			onlineUsersTask.delay((_app.chat_refresh_in_second || 60) * 1000);
		}
	}
}

function getPictureUrl(picId, miniFlag) {
	miniFlag = !!miniFlag;
	switch (picId) { //default pictures
		case 1: //erkek
			return miniFlag ? "../images/custom/ppicture/default_man_mini.png" : "../images/custom/ppicture/default_man.png";
		case 2: //bayan
			return miniFlag ? "../images/custom/ppicture/default_woman_mini.png" : "../images/custom/ppicture/default_woman.png";
		default: //ozel
			return "./dl/ppicture_" + picId + ".png?_fai=" + picId;
	}
}



function openChatWindow(userId, dsc, force) {
	if (1 * _app.chat_flag == 0 || !userId || userId == _scd.userId || !dsc) return false;
	if (_scd.chatStatusTip == 0) {
		if (!confirm('Su anda çevrimdisisiniz. Mesaj göndermek için, çevrimiçi olmak ister misiniz?')) return false;
		promisRequest({
			url: 'ajaxChangeChatStatus',
			requestWaitMsg: false,
			params: {
				chatStatusTip: 1
			}
		})
	}
	var idx = 'idChatWith_' + userId;
	var cmp = Ext.getCmp("promis_" + idx);
	if (!cmp) { //eger yoksa boyle chat penceresi, force durumuna gore collapsed veya expanded ac
		mainPanel.loadTab({
			attributes: {
				id: idx,
				modalWindow: true,
				href: "showPage?_tid=834",
				_sel: dsc,
				params: {
					xother_user_id: userId
				}
			}
		});
	} else { //eger varsa, ve collapsed ise, expand et
		if (cmp.getHeight() == 0) {
			//            if(force)cmp.fireEvent('minimize',cmp); else//expand(false);//TODO: hata var, calismiyor
			var umc = Ext.get('idUserMsgCount1_' + userId);
			if (umc) umc.dom.innerHTML = '1';
		}
		var gxx = Ext.getCmp('idChatGrid_' + userId);
		if (gxx) gxx.store.reload();
		//cmp.focus();
		var chatWindow = Ext.getCmp('idChatWindow_' + userId);
		chatWindow.newMessage(new Date());
	}

	return false;
}


function addGrid4Relogin(g){
	if(!_scd.reloadGrids)_scd.reloadGrids=[];
	_scd.reloadGrids.push(g);
}

function refreshGridsAfterRelogin(){
	if(!_scd.reloadGrids)for(var qi=0;qi<_scd.reloadGrids.length;qi++);
		_scd.reloadGrids[qi].store.reload();
}

var cmbUserType = new Ext.form.ComboBox({width:215, typeAhead: false, mode: 'local',triggerAction: 'all',selectOnFocus:true,forceSelection:true, store:new Ext.data.JsonStore({url:'ajaxQueryData?_qid=586&.t='+_page_tab_id+'&.w='+_webPageId,root:'data',totalProperty:'browseInfo.totalCount',id:'id',fields:[{name:'dsc'},
{name:'id',type:'int'}],listeners:{loadexception:promisLoadException}}),valueField:'id',displayField:'dsc'});

function reloadUserTipCombo(){
	cmbUserType.setValue('');
	cmbUserType.store.reload({callback:function(aq,bq){
		if(aq && aq.length){
			cmbUserType.setValue(aq[0].id);
			cmbUserType.fireEvent('select');

		}
	}});
}

Ext.onReady(function() {
        document.getElementById('loading-mask').outerHTML = "";
        document.body.style.background='#3f4757';

	Ext.util.JSON.encodeDate = function(d) {
		return d.format('"d/m/Y H:i:s"');
	};


	var userForm = 131;
	var userLink = "<a style='color:white; font-size:1.3em;' href=# onclick='mainPanel.loadTab({attributes:{id:\"idMyProfileXXX\",href:\"showForm?_fid=" + userForm + "&tuser_id=" + _scd.userId + "&a=1\"}});return false;' >";
	if (_app.profile_picture_flag && 1 * _app.profile_picture_flag && _scd.ppictureId) {
		Ext.get("userImageTd").dom.innerHTML = userLink + getPPicImgTag(_scd.userId) + '</a>';
	}
	var udsc = userLink + _scd.userName + "<span id='idOnlineCount'></span></a>";
	Ext.get("userNameTd").dom.innerHTML = udsc;

	if(typeof(qry_chat_unread_msg_count) != 'undefined')updateChatMsgCount(1 * qry_chat_unread_msg_count1.data[0].cnt);

	var roleStr = _scd.roleDsc;// + (!_scd.unitDsc || _scd.unitDsc + "" == "" ? "" : "/" + _scd.unitDsc);
	if (1 * _scd.roleCount > 1) {
		Ext.get("switchRole").dom.innerHTML = "<div style='padding-left:1px;width:40px;display:block;'> · <a style='color:white; font-size:1.2em;' href=# onclick='selectUserRole(event)' > Dev </a></div>";
    }

	Ext.SSL_SECURE_URL = "../ext3.4.1/images/default/s.gif";
	Ext.BLANK_IMAGE_URL = "../ext3.4.1/images/default/s.gif";

	Ext.QuickTips.init();
	Ext.apply(Ext.QuickTips.getQuickTip(), {
		dismissDelay: 0
	});
	var bbbar = [' ', {cls:'xbutton p2x',text:'Preferences', handler:function(){return mainPanel.loadTab({attributes:{modalWindow:true, notAutoHeight:true, href:'showForm?_fid=2581&a=1&tproject_uuid='+cmbProject.getValue()}});}}, '->',{cls:'red-reload',id:'idBtnCacheReload',iconCls:'x-tbar-loading', tooltip:'Reload Cache', handler:function(){reloadCache({callback:reloadDevMenu});}}];
	menuPanel = new MenuPanel({region:'center',menu:developer_main_menu, bbar:bbbar});

	function onTreeNodeClick(node, e) {
		if(e.browserEvent && e.browserEvent._iwb)return;
		if (node.isLeaf()) {
			e.stopEvent();
			mainPanel.loadTab(node, e);
		}
	}
	menuPanel.on('click', onTreeNodeClick);

	var bi = _app.interactive_tutorial_flag && 1*_app.interactive_tutorial_flag;
	//var cmbSt= new Ext.data.JsonStore({id:'id',fields:[{name:'dsc'},{name:'id',type:'int'}]});	cmbSt.loadData(lookup_w5_project.data);
	var cmbSt=[];
	if(lookup_w5_project.data)for(var qi=0;qi<lookup_w5_project.data.length;qi++)cmbSt.push([lookup_w5_project.data[qi].id, lookup_w5_project.data[qi].dsc]);
	var cmbProject = new Ext.form.ComboBox({typeAhead:!0,id:'idActiveProject',width:215, mode: 'local',triggerAction: 'all',selectOnFocus:true,forceSelection:true, value:_scd.projectId, store:cmbSt,
	listeners:{beforeselect:function(){if(!confirm('Will Close All the tabs before Continue?'))return false;mainPanel.doClose(false);return true;},select:function(){
	promisRequest({
		url: 'ajaxChangeActiveProject',
		requestWaitMsg: true, params: {_uuid: cmbProject.getValue()}, successCallback:function(){_scd.projectId=cmbProject.getValue();reloadUserTipCombo();
		}
	});
}}});


	var ttbar = [' ', cmbProject, ' '];

//	var allItems = [item1];

	cmbUserType.on('select', reloadDevMenu);

	reloadUserTipCombo.defer(1000);

	var dtbar = [' ', cmbUserType, ' '];
//	dtbar.push(' ', {cls:'red-reload',iconCls:'x-tbar-loading', tooltip:'Reload Cache', handler:function(){reloadCache({callback:reloadDevMenu});}});
	var dbbar=[' ', new Ext.form.TextField({
		width: '230', emptyText: '${search}', enableKeyEvents: true,
		listeners: {
			render: function(f) {
				devMenuPanel.filter = new Ext.tree.TreeFilter(devMenuPanel, {
					clearBlank: true,
					autoClear: true
				});
			},
			keydown: {
				fn: function(aq,bq,cq){console.log(aq);console.log(bq);console.log(this);devMenuPanel.filterTree(aq,bq);},
				buffer: 350,
				scope: this
			},
			scope: this
		}
	})]
	devMenuPanel= new MenuPanel({id:'ali-baba-tree', dataUrl:'ajaxQueryData?_qid=609', title:'Application Preview Menu', split:true, tbar: dtbar, /*bbar:dbbar, */region:'south'});
	devMenuPanel.height=300;

	function onTreeNodeClick2(node, e) {
		if(e.browserEvent && e.browserEvent._iwb)return;
		if (node.isLeaf()) {
			e.stopEvent();
			if(!e.ctrlKey){
//				console.log('node',node);
				var newNode=Ext.apply({},node);
				var tid=newNode.attributes.href.split('_tid=')[1];
				newNode.attributes.__tid=tid;
				newNode.attributes.href='showPage?_tid=2434&__tid='+tid;
				node = newNode;
			}
			mainPanel.loadTab(node, e);
		}
	}


	devMenuPanel.on('click', onTreeNodeClick2);
//	reloadDevMenu.defer(1000);


	var devPanel=new Ext.Panel({title:'Application',id:'idProjects',region: 'west',
		width: 220,layout:'border',border:false, split: true,
		collapsible: true,//collapseMode: 'mini',
        tbar:ttbar,items:[menuPanel, devMenuPanel]});
	var leftPanel = devPanel;
	var mainViewportItems = [{
			cls: 'docs-header',
			height: 37,
			region: 'north',
			xtype: 'box',
			el: 'header2',
			border: false,
			margins: '0 0 5 0'
		},
		leftPanel, mainPanel,{
								xtype: 'box',
                region: 'south',
                height: 25,
								id:'idSouthBox', hidden:true,
                el: 'footer2'
            }
	]
	if (_app.chat_flag && 1 * _app.chat_flag != 0) {
		chatStatusMenu = []
		for (var qi = 3; qi >= 0; qi--) {
			var btn = {
				id: 'id-chat-status-' + qi,
				text: _lookups.chat_status_tip[qi],
				_text: _lookups.chat_status_tip[qi],
				_id: qi,
				iconCls: 'status-' + qi,
				handler: function(aa, bb, cc) {
					promisRequest({
						url: 'ajaxChangeChatStatus',
						requestWaitMsg: false,
						params: {
							chatStatusTip: aa._id
						}
					})
				}
			};
			if (qi == _scd.chatStatusTip) btn.text = '<b>' + btn._text + '</b>';
			chatStatusMenu.push(btn);
		}
		chatStatusMenu = new Ext.menu.Menu({
			enableScrolling: false,
			items: chatStatusMenu
		});
		var userTextField = null;
		var bbar = [' ',
			userTextField = new Ext.form.TextField({
				width: 210,
				emptyText: '${search}',
				enableKeyEvents: true,
				listeners: {
					keydown: {
						fn: function() {
							onlineUsersGridPanel.store.filter('adi_soyadi', userTextField.getValue());
						},
						buffer: 350,
						scope: this
					},
					scope: this
				}
			}), ' ', ' ', {
				id: 'id-chat-status-icon',
				iconCls: 'status-' + _scd.chatStatusTip,
				tooltip: _lookups.chat_status_tip[_scd.chatStatusTip], // || 'Chat Status'
				handler: function(aa, bb, cc) {
					bb.stopEvent();
					var coords = bb.getXY();
					chatStatusMenu.showAt([coords[0] - 20, coords[1] - 20]);
				},
				scope: this
			}
		];
		onlineUsersGridPanel = new Ext.list.ListView(Ext.apply(lv_online_users1, {
			region: 'center',
			hideHeaders: true,
			border: 0
		}));
		addGrid4Relogin(onlineUsersGridPanel);
		onlineUsersGridPanel.on('render', function() {
			new Ext.dd.DropTarget(onlineUsersGridPanel.getEl().dom, {
				ddGroup: 'dd-main-tabpanel-group',
				notifyDrop: function(ddSource, e, data) {
					if (!ddSource.dropEl || (!ddSource.dropEl._lg && !ddSource.dropEl._l)) return false;
					var url = getUrlFromTab(ddSource.dropEl);
					if (!url) return false;
					var aq = onlineUsersGridPanel;
					var item = e.getTarget(aq.itemSelector, aq.getTemplateTarget());
					if (item) {
						var sel = aq.store.getAt(aq.indexOf(item))
						if (sel) {
							console.log(sel);
							if (confirm('[' + ddSource.dropEl.title + '] i, [' + sel.data.adi_soyadi + '] kullanicisina gondermek istediginizden emin misiniz?')) {
								promisRequest({
									url: 'ajaxBookmarkForm',
									requestWaitMsg: false,
									params: {
										_dsc: url,
										_fid: ddSource.dropEl._formId,
										a: 11
									},
									successCallback: function(j) {
										if (j.id) postMsgGlobal('!{' + j.id + '-' + ddSource.dropEl.title + '}', sel.data.user_id, sel.data.adi_soyadi);
									}
								});
							}
							return true
						}
					}
					return false;

				},
				notifyOver: function(dd, e, data) {
					if (!e.within(this.getEl())) {
						return 'x-dd-drop-nodrop';
					}
					return 'x-dd-drop-ok';
				}
			});
		})
		onlineUsersGridPanel.store.on('load', function(ax, bx, cx) {
			if (bx) {
				var cnt = 0;
				for (var qi = 0; qi < bx.length; qi++)
					if (bx[qi].data.instance_count) cnt += 1 * bx[qi].data.instance_count;
				updateChatMsgCount(cnt);
			}
		});
		onlineUsersGridPanel.on('click', function(ax, bx, cx) {
			var sel = ax.store.getAt(bx)
			if (!sel) return;
			openChatWindow(sel.id, sel.data.adi_soyadi, true);
		});

		var rightPanel = new Ext.Panel({
			id: 'idOnlineUsersPanel',
			region: 'east',
			border: 0,
			width: 250,
			minSize: 250,
			maxSize: 250,
			title: '<a href=# class="xbutton" style="padding: 1px 4px;" title="Add Member" onclick="return addProjectMember()">+</a> &nbsp;Project Team',
			layout: 'border',
			cmargins: '0 0 0 0',
			//			split: true,
			collapsible: true,
			collapsed: true,
			collapseMode: 'mini',
			items: [onlineUsersGridPanel],
			bbar: bbar
		});
		rightPanel.on('beforeexpand', function() {
			reloadOnlineUsers(true);
		});
		mainViewportItems.push(rightPanel);
		onlineUsersTask = new Ext.util.DelayedTask(function() {
			reloadOnlineUsers(false);
		});
	}

	mainViewport = new Ext.Viewport({
		layout: 'border',
		items: mainViewportItems
	});

	menuPanel.expandPath('/root');
	mainViewport.doLayout();
	mainPanel.loadTab({
		attributes: {
			id: 'sayfam',
			href: 'showPage?_tid=2503'
		}
	});


	var longPollFailureCount = 0;
	var longPollTask = new Ext.util.DelayedTask(function() {
		var tabPgCount = 0,
			params = {};
		if (mainPanel.items && mainPanel.items.items) {
			var itx = mainPanel.items.items;
			for (var qi = 0; qi < itx.length; qi++)
				if (itx[qi]._l) {
					var l = itx[qi]._l
					params[".s" + tabPgCount] = l.pk + ";" + itx[qi].id;
					tabPgCount++;
				}
				/*else if(itx[qi]._gridMap) {
									var l = itx[qi]._gridMap
									params[".g" + tabPgCount] = l.pk + ";" + l.t + "";
									tabPgCount++;
								} */
			if (tabPgCount > 0) {
				params[".c"] = tabPgCount;
			}
		}
		var at = mainPanel.getActiveTab();
		if (at) params[".at"] = at.id;

		Ext.Ajax.request({
			url: '../async/ajaxNotifications?.r=' + Math.random() + "&.w=" + _webPageId+"&.p="+_scd.projectId,
			params: params,
			requestWaitMsg: false,
			timeout: 120 * 1000,
			success: function(ax, bx, cx) {
				if(longPollFailureCount>2){
					hideStatusText();
					longPollFailureCount = 0;
				}

				var json = eval("(" + ax.responseText + ")");
				if(!json.success){
					if(longPollFailureCount>1){
						showStatusText(getLocMsg('js_no_session_error'), 2);
					} else
						longPollFailureCount++;
					longPollTask.delay(5000);
					return;
				}
				longPollFailureCount = 0;
				longPollTask.delay(0);
				if (json.console) {
					var qc=json.console;
					try{
						qc=eval('('+qc+')');
						console[json.level || 'log']('%c'+(json.title||'iCodeBetter-BACKEND CONSOLE'), 'background: #000; color: #ffa62f', qc);
					}catch(qe){
						console[json.level || 'log']('%c'+(json.title||'iCodeBetter-BACKEND CONSOLE'), 'background: #000; color: #ffa62f', json.console);
					}
					Ext.infoMsg.log(json.level||'iCodeBetter-BACKEND CONSOLE', (json.title ? '<b>'+json.title+'</b> &nbsp; ':'')+json.console);
				}else if (json.changeProjectId) {
					_scd.projectId=json.changeProjectId;
					Ext.getCmp('idActiveProject').setValue(_scd.projectId);
					reloadUserTipCombo();mainPanel.doClose(false);
					alert('Active Project Changed');
				}else if (json.notification) {
					var pauseTime = 5;
					var nt = json.notification;
					var ss = ''
					if (nt._tmpStr) {
						if (nt.showUrl) {
							ss = '<a href=# onclick="return fnOpenUrl(\'' + nt.showUrl + '\')">' + nt._tmpStr + '</a>';
							pauseTime = 10;
						} else
							ss = nt._tmpStr;
						ss += '<br>';
					}
					if (nt._tableRecordList) ss += renderParentRecords2(nt._tableRecordList);
					if (1 * nt.notificationTip == 21) {
						Ext.MessageBox.show({
							title: nt._notificationTipStr || getLocMsg('alarm'),
							msg: ss,
							width: 300,
							buttons: Ext.MessageBox.OK
						});
//						check4Widgets('63', true);
					} else {
						Ext.infoMsg.msg('info', ss, pauseTime);
//						if (nt.notificationId && 1 * nt.notificationId) check4Widgets('1', true);
					}
				} else if (json.liveSyncAction) {
					if (1 * json.liveSyncAction == 17) { //chat typing
						var chatWindow = Ext.getCmp('idChatWindow_' + json.userId);
						if (chatWindow) chatWindow.showTyping(true);
						return;
					}
					var tb = mainPanel.getActiveTab();
					if (!tb || !tb._l || tb.id != json.tabId) tb = null;
					var cm = Ext.getCmp('live_sync_' + json.tabId);
					var lb = Ext.getCmp('live_sync_lbl_' + json.tabId);
					var cls = null;
					var html = '';
					switch (1 * json.liveSyncAction) {
						case 15://templateGrid dirty
							tb = mainPanel.getItem(json.tabId);
							if (tb) {
								if (!tb._title) tb._title = tb.title;
								tb.setTitle('<a class="dirtyColor3" href=# onclick="return showNotifications(\'' + json.tabId + '\')">(' + json.msgCount + ') ' + tb._title + '</a>');
							}
							if (json.msg) {
								var msg = syncMaptoStr(json.tabId, json.msg, false);
								if (msg) Ext.infoMsg.msg('warning', msg, 10);
							}
							break;
						case 10: //record opened for update
							if (!json.users) json.users = [];
							json.users.push({
								userId: json.userId,
								userDsc: json.userDsc
							})
							html = 'Live collaboration with: ' + getUsers4Chat(json.users, true) + '.';
							if (lb._text) html += lb._text;
							if (tb) Ext.infoMsg.wow('info', '<img src="sf/pic'+(json.userId)+'.png" class="ppic-middle"> &nbsp;'+getUsers4Chat([json]) + ' just started editing this record.', 2);
							break;
						case 1: //updated
							html = '';
							if (json.users) html += 'Live collaboration with: ' + getUsers4Chat(json.users) + '. ';
							lb._text = getUsers4Chat([json]) + ' just updated it.';
							html += lb._text;
							cls = 'error';
							if (tb) Ext.infoMsg.msg('warning', lb._text, 5);
							break;
						case 2: //tab closed
							if (!json.users || json.users.length == 0) {
								html = false;
							} else {
								html = 'Live collaboration with: ' + getUsers4Chat(json.users) + ' ';
							}
							if (lb._text) html = html ? html + lb._text : 'This record ' + lb._text;
							if (tb) Ext.infoMsg.msg('info', getUsers4Chat([json]) + ' quit editing', 2);
							break;
						case 3: //record deleted
							html = 'This record is DELETED by: ' + getUsers4Chat([json]) + ' !!!';
							cls = 'error';
							lb._text = html;
							if (tb) Ext.infoMsg.msg('warning', html, 10);
							break;
						case 11: //extra info
							var tbIdPk = json.pk.split('-')
							switch (1 * json.extra) {
								case 1: //comment
									var commentModalWindow=Ext.getCmp('id_comment_list_view_'+tbIdPk[0]+'-'+tbIdPk[1]);
									if(commentModalWindow){
										commentModalWindow.store.reload();
									} else {
										var comTlb = Ext.getCmp('cd_' + json.tabId);
										if (comTlb) promisRequest({
											url: 'ajaxQueryData?_qid=2214&xtable_id=' + tbIdPk[0] + '&xtable_pk=' + tbIdPk[1],
											successCallback: function(j) {
												if (j && j.data && j.data.length) {
													var cmtCount = j.data[0].cnt;comTlb._commentCount=cmtCount;
													comTlb.setText('<b class="dirtyColor">${comment}' + (cmtCount && 1 * cmtCount > 0 ? ' (' + cmtCount + ')' : '') + '</b>');
												}
											}
										});
									}

									break;
								case 2: //filAttachment
									break;
								case 3: //accessPrivilege
									break;
							}
							if (tb) Ext.infoMsg.msg('info', 'Bu kayda az önce ' + getUsers4Chat([json]) + ' tarafindan ' + _lookups.live_sync_extra[json.extra], 5);
							break;
						case 4:
						case 5:
						case 6: //fieldFocus,Change,Blur
							if (tb) {
								var f = tb['_' + json.fieldName];
								if (1 * json.liveSyncAction == 4) f.addClass('x-form-live-sync-working');
								else {
									f.el.removeClass('x-form-live-sync-working');
									if (1 * json.liveSyncAction == 5) {
										f.addClass('x-form-live-sync-changed');
										f._lastEditedBy = { userId: json.userId, userDsc: json.userDsc }
										if (true) //TODO: syncTip'e bak
											f.setValue(json.newValue);
										else
											f._newValue = json.newValue;
									}
								}
							}
							return;
                      default:
                        if(iwb['liveSyncAction'+json.liveSyncAction+'Func'])iwb['liveSyncAction'+json.liveSyncAction+'Func'](json);
                        return;

					}
					if (html || (lb && lb._text)) {
						lb.setText(html || lb._text, false);
						if (cls) {
							lb.removeClass('information');
							lb.addClass(cls);
						}
						cm.show();
					} else if (cm) cm.hide();
				} else if (json.feed) {
					check4Feeds(json);
				} else if (json.userStatusUpdate) {
					var bq = true;
					if (json.userId == _scd.userId) {
						bq = false;
						if (json.chatStatusTip != _scd.chatStatusTip) {
							if (_scd.chatStatusTip == 0) bq = true;
							var mm = Ext.getCmp('id-chat-status-' + _scd.chatStatusTip);
							if (mm) mm.setText(mm._text);
							mm = Ext.getCmp('id-chat-status-' + json.chatStatusTip);
							if (mm) mm.setText('<b>' + mm._text + '</b>');
							mm = Ext.getCmp('id-chat-status-icon')
							if (mm) mm.setIconClass('status-' + json.chatStatusTip);
							_scd.chatStatusTip = json.chatStatusTip;
							if (json.chatStatusTip == 0) { //offline
								onlineUsersGridPanel.store.removeAll();
							}
						}
						if (json.remoteIp) Ext.infoMsg.msg('warning', '<b>' + json.remoteIp + '</b> adresinden yeni giris yapildi', 7);
						Ext.get('idOnlineCount').dom.innerHTML = json.onlineCount > 1 ? ' (' + json.onlineCount + ')' : '';
					}
					if (bq) reloadOnlineUsers();
				} else if (json.userChatMsg) {
					if (_scd.chatStatusTip > 0) {
						clearInterval(timerChat);
						timerChat = window.setInterval(function() {
							document.title = document.title == 'iCodeBetter' ? getLocMsg('new_message') : 'iCodeBetter';
						}, 1000);
						openChatWindow(json.userId, json.userDsc, false);
					}
				}
			},
			failure: function(ax, bx, cx) {
				longPollFailureCount++;
				if(longPollFailureCount==3){
					showStatusText(getLocMsg('js_no_connection_error'), 3);
				}
				longPollTask.delay(longPollFailureCount<5? 5000:15000);
			}
		});
	});
	longPollTask.delay(1000);
	window.onbeforeunload = function() {
		Ext.Msg.show=function(){};//hack
		promisRequest({ url: 'ajaxLiveSync?.a=101' , params:{".w":_webPageId}, requestWaitMsg: false, successResponse: function() {} });
	};

});

iwb.ext=true;
</script>


<span style="display: none;" id="idGSearch"><span onclick="globalSearch()" id="idGSearch2" style="position: fixed;width: 100%;height: 100%;background-color: black;z-index: 20000;transition: opacity .2s;opacity: 0.8;"></span>
    <input type="text" placeholder="Search..." id="idGSearchInput" onkeydown="globalSearchKeydown(event)" autocomplete="off" style="
    display: block;border: 0;width: 60%;padding: 15px;-webkit-appearance: none;border: none;
    outline: none;background: #fff;font-size: 30px;
    box-sizing: border-box;margin: 0;color: #555459;height: 70px;position: fixed;z-index: 20001;
    left: 20%;top: 16%;
"><form id="idGFSearch" style="width: 60%;padding: 15px;-webkit-appearance: none;border: none;outline: none;position: fixed;z-index: 20001;
    left: 20%;top: 16%;margin-top: 70px;
    font-family: tahoma;color: #b7b7b7;font-size: 14px;"><input type="radio" name="xsearch_tip" value="1" checked=""> Frontend JS Code &nbsp; &nbsp; &nbsp; <input type="radio" name="xsearch_tip" value="2"> Backend JS Code &nbsp; &nbsp; &nbsp; <input type="radio" name="xsearch_tip" value="3"> SQL &nbsp; &nbsp; &nbsp; <input type="radio" name="xsearch_tip" value="4"> Others<span style="float: right;margin-right: 26px;"><input type="radio" name="xsearch_tip" value="10"> Stackoverflow</span></form></span>
</body>
</html>
